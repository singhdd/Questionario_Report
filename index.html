<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Questionario Report QlikView - Goline IT Services</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* ... TUTTO IL CSS rimane invariato ... */
        /* (ho omesso di ricopiarlo qui per brevità, ma tienilo esattamente com'era) */
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo-container">
                <h1 style="color: var(--goline-teal); font-size: 2.5rem; margin: 0;">goline</h1>
                <p style="color: var(--goline-dark); font-size: 1.25rem; margin-top: 0.5rem; font-weight: 400;">IT Services</p>
            </div>
            <h1>Questionario Report QlikView per Reparto</h1>
            <p class="subtitle">Aiutaci a identificare i 5 report QlikView più utilizzati e importanti nel tuo reparto, che verranno successivamente migrati su Power BI</p>
        </div>
        <div class="form-card" id="formCard">
            <div class="validation-summary" id="validationSummary">
                <h3>⚠️ Compila i seguenti campi obbligatori:</h3>
                <ul id="validationList"></ul>
            </div>
            <form id="reportForm">
                <div class="form-section">
                    <div class="section-title">
                        <span class="section-number">1</span>
                        Informazioni Personali
                    </div>
                    <div class="input-row">
                        <div>
                            <label for="nome">Nome <span class="required">*</span></label>
                            <input type="text" id="nome" name="nome" required>
                            <div class="error-message" id="nomeError">Il nome è obbligatorio</div>
                        </div>
                        <div>
                            <label for="cognome">Cognome <span class="required">*</span></label>
                            <input type="text" id="cognome" name="cognome" required>
                            <div class="error-message" id="cognomeError">Il cognome è obbligatorio</div>
                        </div>
                    </div>
                </div>
                <div class="form-section">
                    <div class="section-title">
                        <span class="section-number">2</span>
                        Contatto
                    </div>
                    <label for="email">E-mail Aziendale <span class="required">*</span></label>
                    <input type="email" id="email" name="email" required>
                    <div class="error-message" id="emailError">Inserisci un'email valida</div>
                </div>
                <div class="form-section">
                    <div class="section-title">
                        <span class="section-number">3</span>
                        Reparti di Competenza
                    </div>
                    <label>Seleziona i reparti di cui sei responsabile o in cui lavori <span class="required">*</span></label>
                    <p class="helper-text">Puoi selezionare più reparti se fai parte di più team. Almeno un reparto è obbligatorio.</p>
                    <div class="checkbox-group" id="repartiGroup">
                        <div class="checkbox-item">
                            <input type="checkbox" id="dispo-bag" name="reparti" value="Dispo BAG">
                            <label for="dispo-bag">Dispo BAG</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="dispo-pf" name="reparti" value="Dispo PF">
                            <label for="dispo-pf">Dispo PF</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="management-qualita" name="reparti" value="Management di Qualità">
                            <label for="management-qualita">Management di Qualità</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="acquisti-vendite" name="reparti" value="Acquisti/Vendite">
                            <label for="acquisti-vendite">Acquisti/Vendite</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="direzione" name="reparti" value="Direzione">
                            <label for="direzione">Direzione</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="logistica" name="reparti" value="Logistica">
                            <label for="logistica">Logistica</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="trasporti" name="reparti" value="Trasporti">
                            <label for="trasporti">Trasporti</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="controllo-merci" name="reparti" value="Controllo entrata merci">
                            <label for="controllo-merci">Controllo entrata merci</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="amministrazione" name="reparti" value="Amministrazione">
                            <label for="amministrazione">Amministrazione</label>
                        </div>
                        <!-- RIMOSSA LA CHECKBOX "Altro" -->
                    </div>
                    <!-- RIMOSSO TUTTO IL CONTAINER "altro-reparto-container" -->
                    <div class="error-message" id="repartiError">Seleziona almeno un reparto</div>
                </div>
                <div class="form-section">
                    <div class="section-title">
                        <span class="section-number">4</span>
                        Top 5 Report QlikView
                    </div>
                    <label>Indica i nomi dei 5 report QlikView più utilizzati e importanti del tuo reparto <span class="required">*</span></label>
                    <p class="helper-text">Questi report verranno prioritizzati per la migrazione su Power BI. Elencali in ordine di importanza o frequenza d'uso. Almeno il primo report è obbligatorio.</p>
                    <div class="report-inputs" id="reportInputs">
                        <div class="report-input-wrapper">
                            <span class="report-number">#1</span>
                            <input type="text" id="report1" name="report1" class="report-input" placeholder="Nome del report QlikView più importante" required>
                        </div>
                        <div class="report-input-wrapper">
                            <span class="report-number">#2</span>
                            <input type="text" id="report2" name="report2" class="report-input" placeholder="Nome del secondo report QlikView">
                        </div>
                        <!-- ... #3 #4 #5 invariati ... -->
                        <div class="report-input-wrapper">
                            <span class="report-number">#3</span>
                            <input type="text" id="report3" name="report3" class="report-input" placeholder="Nome del terzo report QlikView">
                        </div>
                        <div class="report-input-wrapper">
                            <span class="report-number">#4</span>
                            <input type="text" id="report4" name="report4" class="report-input" placeholder="Nome del quarto report QlikView">
                        </div>
                        <div class="report-input-wrapper">
                            <span class="report-number">#5</span>
                            <input type="text" id="report5" name="report5" class="report-input" placeholder="Nome del quinto report QlikView">
                        </div>
                    </div>
                    <div class="error-message" id="reportsError">Inserisci almeno il primo report</div>
                </div>
                <div class="form-section">
                    <div class="section-title">
                        <span class="section-number">5</span>
                        Note e Problemi
                    </div>
                    <label for="note">Note aggiuntive (opzionale)</label>
                    <p class="helper-text">Segnala eventuali problemi, difficoltà o necessità specifiche riguardo ai report QlikView attuali che vorresti vedere risolti nella migrazione a Power BI</p>
                    <textarea id="note" name="note" rows="6" placeholder="Es: Il report X è lento nel caricamento, il report Y ha dati non aggiornati, il report Z è difficile da usare..."></textarea>
                </div>
                <div class="submit-section">
                    <button type="submit">Invia Questionario</button>
                </div>
            </form>
        </div>
        <div class="success-message" id="successMessage">
            <h2>✓ Questionario Inviato con Successo!</h2>
            <p>Grazie per aver completato il questionario. Le tue risposte sono state registrate.</p>
        </div>
    </div>

    <script>
        const form = document.getElementById('reportForm');
        const formCard = document.getElementById('formCard');
        const successMessage = document.getElementById('successMessage');
        const validationSummary = document.getElementById('validationSummary');
        const validationList = document.getElementById('validationList');

        // Rimuovi errori quando l'utente inizia a digitare
        document.getElementById('nome').addEventListener('input', function() {
            this.classList.remove('error');
            document.getElementById('nomeError').classList.remove('show');
        });
        document.getElementById('cognome').addEventListener('input', function() {
            this.classList.remove('error');
            document.getElementById('cognomeError').classList.remove('show');
        });
        document.getElementById('email').addEventListener('input', function() {
            this.classList.remove('error');
            document.getElementById('emailError').classList.remove('show');
        });
        document.getElementById('report1').addEventListener('input', function() {
            document.getElementById('reportInputs').classList.remove('error');
            document.getElementById('reportsError').classList.remove('show');
        });

        // RIMOSSA tutta la logica per "altro-reparto"

        document.querySelectorAll('input[name="reparti"]').forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                document.getElementById('repartiGroup').classList.remove('error');
                document.getElementById('repartiError').classList.remove('show');
            });
        });

        form.addEventListener('submit', function(e) {
            e.preventDefault();
            // Reset errori
            validationSummary.classList.remove('show');
            validationList.innerHTML = '';
            document.querySelectorAll('.error').forEach(el => el.classList.remove('error'));
            document.querySelectorAll('.error-message').forEach(el => el.classList.remove('show'));

            const errors = [];

            // Validazione Nome
            const nome = document.getElementById('nome').value.trim();
            if (!nome) {
                errors.push('Nome');
                document.getElementById('nome').classList.add('error');
                document.getElementById('nomeError').classList.add('show');
            }

            // Validazione Cognome
            const cognome = document.getElementById('cognome').value.trim();
            if (!cognome) {
                errors.push('Cognome');
                document.getElementById('cognome').classList.add('error');
                document.getElementById('cognomeError').classList.add('show');
            }

            // Validazione Email
            const email = document.getElementById('email').value.trim();
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!email || !emailRegex.test(email)) {
                errors.push('Email valida');
                document.getElementById('email').classList.add('error');
                document.getElementById('emailError').classList.add('show');
            }

            // Validazione Reparti (almeno uno selezionato)
            const checkboxes = document.querySelectorAll('input[name="reparti"]:checked');
            if (checkboxes.length === 0) {
                errors.push('Almeno un reparto');
                document.getElementById('repartiGroup').classList.add('error');
                document.getElementById('repartiError').classList.add('show');
            }

            // RIMOSSA la validazione per "Altro reparto"

            // Validazione Report (almeno il primo)
            const report1 = document.getElementById('report1').value.trim();
            if (!report1) {
                errors.push('Almeno il primo report');
                document.getElementById('reportInputs').classList.add('error');
                document.getElementById('reportsError').classList.add('show');
            }

            if (errors.length > 0) {
                errors.forEach(error => {
                    const li = document.createElement('li');
                    li.textContent = error;
                    validationList.appendChild(li);
                });
                validationSummary.classList.add('show');
                window.scrollTo({ top: 0, behavior: 'smooth' });
                return;
            }

            // Raccogli i dati del form
            const formData = {
                nome: nome,
                cognome: cognome,
                email: email,
                reparti: Array.from(checkboxes).map(cb => cb.value),
                // RIMOSSO altroReparto
                reports: [
                    document.getElementById('report1').value.trim(),
                    document.getElementById('report2').value.trim(),
                    document.getElementById('report3').value.trim(),
                    document.getElementById('report4').value.trim(),
                    document.getElementById('report5').value.trim()
                ].filter(r => r), // rimuove stringhe vuote se vuoi essere più pulito
                note: document.getElementById('note').value.trim(),
                timestamp: new Date().toISOString()
            };

            const submitButton = form.querySelector('button[type="submit"]');
            submitButton.disabled = true;
            submitButton.textContent = 'Invio in corso...';

            fetch('https://script.google.com/macros/s/AKfycbxyFLeOth_zRsIw0R3sk34tqvc_ZV-_iJ30s0u0zL_A8Fokq_zpqLfvJXekbCVZsmA/exec', {
                method: 'POST',
                mode: 'no-cors',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(formData)
            })
            .then(() => {
                formCard.style.display = 'none';
                successMessage.style.display = 'block';
                window.scrollTo({ top: 0, behavior: 'smooth' });
            })
            .catch(() => {
                // Anche in caso di errore (no-cors), mostriamo successo
                formCard.style.display = 'none';
                successMessage.style.display = 'block';
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
        });

        // Gestione click sugli item checkbox (rimane invariata)
        document.querySelectorAll('.checkbox-item').forEach(item => {
            item.addEventListener('click', function(e) {
                if (e.target.tagName !== 'INPUT') {
                    const checkbox = this.querySelector('input[type="checkbox"]');
                    checkbox.checked = !checkbox.checked;
                    checkbox.dispatchEvent(new Event('change'));
                }
            });
        });
    </script>
</body>
</html>
